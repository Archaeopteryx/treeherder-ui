<!DOCTYPE html>
<html ng-app="logViewer">
    <head>
        <title>Treeherder Log Viewer </title>
        <!-- build:css css/logviewer.min.css -->
        <link href="css/bootstrap.css" rel="stylesheet" media="screen">
        <link href="css/treeherder.css" rel="stylesheet" type="text/css">
        <link href="css/logviewer.css" rel="stylesheet" type="text/css">
        <!-- endbuild -->
    </head>
    <body ng-controller="LogviewerCtrl" ng-init="init()" class="body-logviewer">
        <div class="run-data">
            <div class="col-md-6">
                <table class="table table-condensed">
                    <tr ng-repeat="(label, value) in artifact.header">
                        <th>{{label}}</th><td>{{value}}</td>
                    </tr>
                </table>
            </div>
            <div class="col-md-6">
                <div class="steps-data">
                    <div ng-repeat="step in artifact.step_data.steps"
                         ng-click="displayLog(step)"
                         ng-class="{'selected': (mostVisibleOrder === step.order)}"
                         ng-if="step.error_count !== 0"
                         class="btn btn-block logviewer-step clearfix btn-warning">
                        <span class="pull-left clearfix">{{step.order+1}}. {{step.name}}</span>
                        <span ng-init="time=formatTime(step.duration)"
                             ng-mouseover="time=displayTime(step.started, step.finished)"
                             ng-mouseleave="time=formatTime(step.duration)"
                            class="pull-right clearfix">{{time}}</span>
                        <div>
                            <p>
                                <div ng-repeat="error in step.errors"
                                     ng-mouseover="check=(step==displayedStep)"
                                     ng-mouseleave="check=false"
                                     ng-class="{'lv-line-highlight': check}"
                                     ng-click="scrollTo($event, step, error.linenumber);"
                                     class="text-left pull-left lv-error-line">
                                    <span class="label label-default lv-line-no">{{error.linenumber}}</span>
                                    <span title="{{error.line}}">{{error.line | limitTo: 67}}</span><span ng-if="error.line.length > 70">...</span>
                                </div>
                            </p>
                        </div>
                    </div>

                    <hr ng-if="show_successful === true" />

                    <div ng-repeat="step in artifact.step_data.steps"
                         ng-click="displayLog(step)"
                         ng-class="{'selected': (mostVisibleOrder === step.order), 'btn-success': (step.error_count === 0), 'btn-warning': (step.error_count > 0)}"
                         ng-if="show_successful === true"
                         class="btn btn-block logviewer-step clearfix">
                        <span class="pull-left clearfix">{{step.order+1}}. {{step.name}}</span>
                        <span ng-init="time=formatTime(step.duration)"
                             ng-mouseover="time=displayTime(step.started, step.finished)"
                             ng-mouseleave="time=formatTime(step.duration)"
                            class="pull-right clearfix">{{time}}</span>
                        <div ng-switch on="(step.error_count > 0)">
                            <p ng-switch-when="true">
                                <div ng-repeat="error in step.errors"
                                     ng-mouseover="check=(step==displayedStep)"
                                     ng-mouseleave="check=false"
                                     ng-class="{'lv-line-highlight': check}"
                                     ng-click="scrollTo($event, step, error.linenumber);"
                                     class="text-left pull-left lv-error-line">
                                    <span class="label label-default lv-line-no">{{error.linenumber}}</span>
                                    <span title="{{error.line}}">{{error.line | limitTo: 67}}</span><span ng-if="error.line.length > 70">...</span>
                                </div>
                            </p>
                        </div>
                    </div>
                </div>
                <input type="checkbox" ng-model="show_successful" />
                Show Successful Steps
            </div>

        </div>

        <div class="lv-log-container" infinite-scroll on-scroll="loadMore(bounds, element)">
            <div class="lv-log-loading"
                 ng-if="loading"> Loading... </div>

            <div ng-repeat="lv_line in displayedLogLines"
                 ng-class="{'text-danger': (lv_line.hasError == true), 'lv-selected-lines': (mostVisibleOrder === lv_line.order)}"
                 class="lv-log-line"
                 order="{{ lv_line.order }}"
                 line="{{ lv_line.index }}">

                 <span class="lv-line-number">{{ lv_line.index }}</span>
                 <span class="lv-line-text">{{ lv_line.text }}</span>
            </div>
        </div>

        
    <!-- build:js js/logviewer.min.js -->
    <script src="vendor/angular/angular.js"></script>
    <script src="vendor/angular/angular-route.js"></script>
    <script src="vendor/angular/angular-resource.js"></script>
    <script src="vendor/angular/angular-cookies.js"></script>
    <script src="vendor/angular-local-storage.min.js"></script>
    <script src="vendor/zeroclipboard/ZeroClipboard.min.js"></script>
    <script src="vendor/ng-clip.min.js"></script>
    <script src="vendor/underscore-min.js"></script>
    <script src="vendor/ui-bootstrap-tpls-0.10.0.min.js"></script>
    <script src="vendor/jquery-2.0.3.js"></script>
    <script src="vendor/bootstrap.js"></script>
    <script src="vendor/angular/angular-sanitize.min.js"></script>
    <script src="js/config/local.conf.js"></script>
    <script src="js/app.js"></script>
    <script src="js/services/main.js"></script>
    <script src="js/services/log.js"></script>
    <script src="js/models/job_artifact.js"></script>
    <script src="js/models/log_slice.js"></script>
    <script src="js/providers.js"></script>
    <script src="js/controllers/logviewer.js"></script>
    <script src="js/directives/infinite_scroll.js"></script>
    <!-- endbuild -->
    </body>
</html>
